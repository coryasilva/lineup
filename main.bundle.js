(()=>{var C=()=>new Date().getTime().toString(36),z=(...n)=>n.reduce((e,t)=>e+t,0),E=(...n)=>n.length===0?0:z(...n)/n.length,$=(...n)=>{let e=E(...n);return E(...n.map(t=>(t-e)**2))},G=(...n)=>Math.sqrt($(...n));function s(n,...e){let t=document.createElement(n);for(let i of e){if(typeof i=="string"&&t.append(i),typeof i=="number"&&t.append(i.toString()),Array.isArray(i)){let a=document.createDocumentFragment();a.append(...i),t.append(a)}if(typeof i=="object"&&i!==null&&!Array.isArray(i)){let a=Object.keys(i);for(let o of a)if(o==="class"){let m=/\s+/,h=Array.isArray(i.class)?i.class:i.class?.toString().split(m);for(let u of h){if(u===!1||u===void 0||u===null)continue;let b=u?.toString()?.trim().split(m)??[];u!==""&&t.classList.add(...b)}}else t.setAttribute(o,i[o]?.toString()??"")}}return t}var d=document.querySelector.bind(document),N=document.querySelectorAll.bind(document);var H=Object.freeze({GOALIE:"G",FIELDER:"F"}),g=class n{constructor(e){this.id=e.id,this.name=e?.name??"",this.number=e?.number??"",this.skill=Number.isInteger(e?.skill)?e.skill:50,this.skill<0&&(this.skill=0),this.skill>100&&(this.skill=100),this.active=!!e?.active,this.position=Object.values(H).map(t=>t.toString()).includes(e?.position?.toUpperCase())?e.position.toUpperCase():H.FIELDER}isGoalie(){return this.position==="G"}toString(e=","){return[this.id??"",this.name??"",this.number??"",this.skill??"",this.position??"",this.active?"1":"0"].join(e)}static fromString(e,t=","){let[i,a,o,m,h,u]=e.split(t);return new n({id:i,name:a,number:o,skill:Number.parseInt(m,10),position:h,active:u==="1"})}};var L=class{#t;#e=new Map;#s=[];constructor(e=window){this.#t=e,this.#a(),this.#t.addEventListener("hashchange",this.#a)}#l(e){return new URLSearchParams(e).getAll("p").map(i=>g.fromString(i,"~"))}#o(){let e=Array.from(this.#e.values());return new URLSearchParams(e.map(t=>["p",t.toString("~")]))}#i(e=!1){let t=`#${this.#o()}`;e?this.#t.history.pushState(null,null,t):this.#t.history.replaceState(null,null,t)}#a=()=>{try{let e=this.#l(this.#t.location.hash.substring(1));this.#e=new Map(e.map(t=>[t.id,t])),this.#r("load",this.players),this.#i()}catch(e){console.error("Failed to load model",e)}};addListener(e){this.#s.push(e)}#r(e,t){for(let i of this.#s)i(e,t)}get players(){return Array.from(this.#e.values())}get playerCount(){return this.#e.size}get activeGoalies(){return Array.from(this.#e.values()).filter(e=>e.isGoalie()&&e.active)}get activeFielders(){return Array.from(this.#e.values()).filter(e=>!e.isGoalie()&&e.active)}get activePlayers(){return Array.from(this.#e.values()).filter(e=>e.active)}getPlayer(e){return this.#e.get(e)}createPlayer(e){if(this.#e.size>=32)throw new Error("Too many players in roster, maximum of 32 allowed.");this.#e.set(e.id,e),this.#r("create",e),this.#i()}updatePlayer(e){this.#e.set(e.id,e),this.#r("update",e),this.#i()}deletePlayer(e){this.#e.delete(e),this.#r("delete",e),this.#i()}validate(){let e=[],t=this.activePlayers.length,i=this.activeGoalies.length;return i===0&&e.push("No Goalie! At least one Goalie is required."),i>3&&e.push("Too many active goalies, maximum of 3 allowed."),t<6&&e.push("Too few active players, minimum of 6 players."),t>16&&e.push("Too many active players, maximum of 16 players."),e}buildLineup(){let e=this.validate().length===0,t=this.activeFielders,i=this.activeGoalies,a=t.concat(i),o=3,m=3,h=o*m,u=5,b=h*u,w=b/t.length,M=Math.ceil(w)-1,F=Math.floor(w)+1,R=Math.ceil(o/i.length),f=new Map(a.map(r=>[r.id,[r,Array.from({length:h},()=>!1),h]])),x=Array.from({length:h},(r,l)=>({line:l+1,sum:0,players:new Map})),k=a.reduce((r,l)=>(r[l.id]=0,r),{});t.sort((r,l)=>l.skill-r.skill),i.sort((r,l)=>l.skill-r.skill);let B=[].concat(...Array(F).fill(t)),T=[].concat(...Array(R).fill(i)),S=0;for(;e&&S<b;)for(let r of B){if(k[r.id]>=F)continue;let l=x.filter(v=>v.players.size<u);if(l.length===0)continue;let p=l.filter(v=>!v.players.has(r.id));if(p.length===0)continue;let c=p.reduce((v,O,j,I)=>O.sum<I[v].sum?j:v,0),y=p[c].line-1;p[c].players.set(r.id,r),p[c].sum+=r.skill,k[r.id]++,f.get(r.id)[1][y]=!0,f.get(r.id)[2]=Math.min(f.get(r.id)[2],y),S++}let A=x.reduce((r,l,p)=>{let c=Math.ceil((p+1)/m);return r[c-1].sum+=l.sum,r},Array.from({length:o},(r,l)=>({period:l+1,sum:0,hasGoalie:!1})));for(let r of T){let l=A.filter(c=>c.hasGoalie===!1);if(l.length===0)continue;let{period:p}=l.sort((c,y)=>c.sum-y.sum)[0];for(let c=0;c>-1*m;c--){let y=p*m-1+c;x[y].players.set(r.id,r),x[y].sum+=r.skill,k[r.id]++,f.get(r.id)[1][y]=!0,f.get(r.id)[2]=Math.min(f.get(r.id)[2],y),A[p-1].hasGoalie=!0}}let P=x.map(r=>r.sum),q=Array.from(f.values()).sort((r,l)=>r[2]-l[2]);return{minFielderOcc:M,maxFielderOcc:F,playerOcc:k,playerRows:q,lineSums:P,standardDeviation:G(...P)}}loadDemo(){let e=[{id:"18rspns",name:"Ryan Getzlaf",number:"15",skill:86,active:!0},{id:"18rsqfk",name:"Ryan Kesler",number:"17",skill:66,active:!0},{id:"18rsr7c",name:"Corey Perry",number:"10",skill:94,active:!0},{id:"18rsrz4",name:"John Gibson",number:"36",skill:75,active:!0,position:"G"},{id:"18rssqw",name:"Rickard Rakell",number:"67",skill:83,active:!0},{id:"18rstio",name:"Andrew Cogliano",number:"7",skill:79,active:!0},{id:"18rsuag",name:"Cam Fowler",number:"4",skill:72,active:!0},{id:"18rsv28",name:"Hampus Lindholm",number:"47",skill:77,active:!0},{id:"18rsvu0",name:"Kevin Bieksa",number:"3",skill:91,active:!0},{id:"18rswls",name:"Jakob Silfverberg",number:"33",skill:88,active:!0},{id:"18rsxdk",name:"Ryan Miller",number:"30",skill:85,active:!1,position:"G"},{id:"18rsy5c",name:"Nick Ritchie",number:"37",skill:96,active:!1},{id:"18rsyx4",name:"Antoine Vermette",number:"50",skill:67,active:!0},{id:"18rszow",name:"Fran\xE7ois Beauchemin",number:"23",skill:87,active:!0},{id:"18rt0go",name:"Ond\u0159ej Ka\u0161e",number:"25",skill:74,active:!1}].map(t=>new g(t));this.#e=new Map(e.map(t=>[t.id,t])),this.#r("load",this.players),this.#i(!0)}};var D=class{constructor(e){this.model=e,this.shareButton=d("#share-button"),this.demoButton=d("#demo-button"),this.rosterSummary=d("#roster-summary"),this.rosterEmpty=d("#roster-empty"),this.rosterList=d("#roster > [role='list']"),this.playerAddButton=d("#player-add-button"),this.playerDialog=d("#player-dialog"),this.playerForm=d("form[name='player']"),this.playerDeleteDialog=d("#player-delete-dialog"),this.playerDeleteForm=d("form[name='player-delete']"),this.lineupBuildButton=d("#lineup-build-button"),this.lineupDialog=d("#lineup-dialog"),this.lineupDialogClose=d("#lineup-dialog-close-button"),this.lineupTable=d("#lineup-table"),this.playerDialog.addEventListener("click",this.dialogHandler),this.playerDeleteDialog.addEventListener("click",this.dialogHandler),this.lineupDialog.addEventListener("click",this.dialogHandler),this.shareButton.addEventListener("click",this.shareHandler),this.demoButton.addEventListener("click",this.demoHandler),this.playerAddButton.addEventListener("click",this.playerAddHandler),this.rosterList.addEventListener("click",this.rosterListHandler),this.playerForm.addEventListener("submit",this.playerFormHandler),this.playerDeleteForm.addEventListener("submit",this.playerDeleteFromHandler),this.lineupBuildButton.addEventListener("click",this.lineupBuildHandler),this.model.addListener(this.listener),this.renderRoster()}listener=(e,t)=>{switch(e){case"load":this.renderRoster();break;case"create":t instanceof g&&this.addPlayer(t);break;case"update":t instanceof g&&this.replacePlayer(t);break;case"delete":typeof t=="string"&&this.removePlayer(t);break}};dialogHandler=e=>{e.target instanceof HTMLElement&&e.currentTarget instanceof HTMLDialogElement&&(e.target.getAttribute("data-modal-backdrop")||e.target.getAttribute("data-action")==="close")&&e.currentTarget.close()};shareHandler=()=>{window.navigator.clipboard.writeText(window.location.href),this.shareButton.replaceChildren("Link copied!"),this.shareButton.classList.add("opacity-0"),setTimeout(()=>{this.shareButton.classList.remove("opacity-0"),this.shareButton.replaceChildren("Share")},1e3)};demoHandler=()=>{this.model.loadDemo()};playerAddHandler=()=>{this.playerDialog.querySelector("h2").replaceChildren("Add player"),this.playerForm.reset(),this.playerForm.id.value="",this.playerForm.position.value="F",this.playerForm.active.checked=!0,this.playerDialog.showModal()};rosterListHandler=e=>{if(!(e.target instanceof HTMLElement))return;let t=e.target.getAttribute("data-player-id"),i=e.target.getAttribute("data-action"),a=this.model.getPlayer(t),o=s("small",{class:"text-xs text-gray-600 font-normal ml-2"},"id: ",a?.id);t&&i==="delete"&&(this.playerDeleteDialog.querySelector("h2").replaceChildren("Delete player",o),this.playerDeleteDialog.querySelector("p").replaceChildren("Are you sure you want to delete the player named ",s("strong",a.name),"?"),this.playerDeleteForm.reset(),this.playerDeleteForm.id.value=a.id,this.playerDeleteDialog.showModal()),t&&i==="update"&&(this.playerDialog.querySelector("h2").replaceChildren("Edit player",o),this.playerForm.reset(),this.playerForm.id.value=a.id,this.playerForm.name.value=a.name,this.playerForm.number.value=a.number,this.playerForm.skill.value=a.skill,this.playerForm.position.value=a.position,this.playerForm.active.checked=a.active,this.playerDialog.showModal())};playerFormHandler=()=>{let e=new FormData(this.playerForm),t=e.get("id").toString(),i=!!t,a=i?"update":"create",o=new g({id:i?t:C(),name:e.get("name").toString(),number:e.get("number").toString(),skill:Number.parseInt(e.get("skill").toString(),10),position:e.get("position").toString(),active:!!e.get("active")});a==="create"&&this.model.createPlayer(o),a==="update"&&this.model.updatePlayer(o),this.playerForm.reset()};playerDeleteFromHandler=()=>{let t=new FormData(this.playerDeleteForm).get("id").toString();this.model.deletePlayer(t),this.playerDeleteForm.reset()};lineupBuildHandler=()=>{console.log(this.model.validate()),this.renderLineup(),this.lineupDialog.showModal()};updateRoster(){let e=this.model.activePlayers.length;this.rosterSummary.replaceChildren(s("span",e,` active player${e===1?"":"s"}, `,this.model.playerCount," total")),this.model.playerCount===0?this.rosterEmpty.classList.remove("hidden"):this.rosterEmpty.classList.add("hidden")}buildPlayer(e){return s("div",{role:"listitem","data-player-id":e.id,class:"flex flex-col border-b border-gray-800 py-4"},[s("div",{class:"flex justify-between text-base font-medium text-gray-200"},[s("h3",[s("span",{"aria-label":e.active?"Active":"Inactive",class:["inline-flex w-2.5 h-2.5 rounded-full me-1.5 shrink-0",e.active?"bg-blue-500":"bg-gray-700"]}),e.name]),s("p","#",e.number)]),s("div",{class:"flex items-center justify-between"},[s("p",{class:"text-sm text-gray-400"},"Skill: ",[s("strong",e.skill),s("span",e.position==="G"&&" | Goalie")]),s("div",{class:"flex gap-2 -mr-2"},[s("button",{type:"button","data-action":"delete","data-player-id":e.id,class:"text-sm font-medium text-red-400 hover:text-red-300 cursor-pointer px-2 py-1 transition-colors"},"Delete"),s("button",{type:"button","data-action":"update","data-player-id":e.id,class:"text-sm font-medium text-blue-400 hover:text-blue-300 cursor-pointer px-2 py-1 transition-colors"},"Edit")])])])}renderRoster(){let e=new DocumentFragment;e.append(...this.model.players.map(this.buildPlayer)),this.rosterList.replaceChildren(e),this.updateRoster()}removePlayer(e){this.rosterList.querySelector(`[data-player-id="${e}"`).remove(),this.updateRoster()}addPlayer(e){this.rosterList.append(this.buildPlayer(e)),this.updateRoster()}replacePlayer(e){this.rosterList.replaceChild(this.buildPlayer(e),this.rosterList.querySelector(`[data-player-id="${e.id}"`))}buildLineupDot(e){return s("td",{class:"py-2 px-1 sm:px-2 border-x border-gray-800 text-center text-gray-200"},[s("div",{class:"inline-flex w-4 h-4 min-w-4 bg-gray-200 rounded-full text-sm align-baseline items-center justify-center empty:hidden"},e&&"X")])}buildLineupPlayer(e,t){let i=a=>s("td",{class:"py-2 px-1 sm:px-2 border-x border-gray-800 text-center text-gray-200"},[s("div",{class:"inline-flex w-4 h-4 min-w-4 bg-gray-200 rounded-full text-sm align-baseline items-center justify-center empty:hidden"},a&&"X")]);return s("tr",{class:"odd:bg-gray-900"},[s("td",{class:"p-2 border-gray-800 text-gray-200 font-medium"},e.name),s("td",{class:"p-2 border-gray-800 text-gray-200 font-medium"},e.number),s("td",{class:"p-2 border-gray-800 text-gray-200 text-center"},e.position),...t.map(a=>i(a))])}buildLineupStats(e,t){return[s("tr",[s("td",{colspan:"3",class:"pt-2 px-2 text-right"},"Line scores:"),...e.map(i=>s("td",{class:"pt-2 px-1 sm:px-2"},i))]),s("tr",{},[s("td",{colspan:"3",class:"px-2 text-right"},"Standard deviation:"),s("td",{colspan:"9",class:"px-1 sm:px-2"},t.toFixed(2))])]}renderLineup(){let{playerRows:e,lineSums:t,standardDeviation:i}=this.model.buildLineup(),a=this.lineupTable.querySelector("tbody"),o=document.createDocumentFragment(),m=this.lineupTable.querySelector("tfoot"),h=document.createDocumentFragment();o.append(...e.map(([u,b])=>this.buildLineupPlayer(u,b))),h.append(...this.buildLineupStats(t,i)),a.replaceChildren(o),m.replaceChildren(h)}};new D(new L);})();
//# sourceMappingURL=main.bundle.js.map
